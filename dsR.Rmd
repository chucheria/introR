---
title: "Ciencia de datos en R"
output: 
  html_notebook:
    toc: true
---

El objetivo de este taller es aprender a hacer una exploración de datos. Si miramos la imagen nos centraremos en el cuadrado azul.

![](http://r4ds.had.co.nz/diagrams/data-science-explore.png)


## Visualización de los datos

### Cargar paquetes

Primero tenemos que cargar los paquetes que nos serán utiles a lo largo de todo el taller. Si no tenemos instalados los paquetes lo hacemos con la instrucción `install.packages()`. Solo necesitas instalarlo una vez.

Para cargar los paquetes lo hacemos con la instrucción `library()`

```{r}
library(ggplot2)
```

### Crear un ggplot

La propia librería `ggplot` nos importa unos dataset pequeños y vamos a utilizar uno de ellos para trabajar. El conjunto de datos se llama `diamonds` y contiene precios y otros atributos de unos 50.000 diamantes.

```{r}
data(diamonds)
```

Si miramos a nuestro entorno podemos ver que ya se nos ha cargado el dataset y se ha quedado almacenado en una variable. Esto no pasa siempre, solo con los set de datos *precargados* en los paquetes de R. Si leyesemos datos de otro sitio tendríamos que almacenarlos en una variable con la asignación `<-`.

#### 1. ¿Cómo podríamos obtener ayuda sobre el dataset?

```{r}
?diamonds
```

A continuación vamos a visualizar los precios por quilates:

```{r}
ggplot(data = diamonds) + 
  geom_point(mapping = aes(x = carat, y = price))
```

Aquí podemos ver la relación entre el precio (`price`) y los quilates (`carat`). Con `ggplot2` empiezas un gráfico llamando a la función `ggplot` y el primer argumento que toma son los datos de los que queremos extraer información. Lo siguiente que vamos haciendo es añadir capas al gráfico, en este caso hemos añadido el tipo de gráfico `geom_point`. El argumento `mapping` toma las variables necesarias para pintar el gráfico.

Además podríamos añadir otras capas como escalas, colores,... 

#### 2. ¿Cómo podemos visualizar la relación entre el precio y el corte?

```{r}
ggplot(data = diamonds) + 
  geom_boxplot(mapping = aes(x = cut, y = price))
```

Utiliza `geom_boxplot` para poder verlo mejor.

#### 3. ¿Cómo podemos ver la relación entre los quilates y el precio diferenciando por corte?

```{r}
ggplot(data = diamonds) + 
  geom_point(mapping = aes(x = carat, y = price, color=cut))
```

Utiliza `color` en el mapeo que es donde selecionamos las columnas de nuestro dataset y asignalo a `cut` para diferenciar los distintos cortes.

**Transformaciones estadísticas**

Hay algún tipo de gráfico como los gráficos de barras que parecen simples pero son muy sutiles. Por ejemplo, si queremos ver el número total de de diamantes agrupados por corte es tan fácil como:

```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut))
```

¡No hemos necesitado especificar el eje y! En el caso de las barras se calcula solo. En otros casos tendríamos:

- Gráficos de barras, histogramas y polígonos de frecuencia se calcula el número de observaciones que caen en cada categoría.
- Boxplots crean una estadística de cada categoría con los diferentes cuartiles.

Los algoritmos usados para hacer estos resúmenes se llaman `stat` y podemos consultar si un gráfico los usa en su ayuda.

#### 4. ¿Qué `stat` usa `geom_bar`?

```{r}
?geom_bar
```

Si quisieses usar otro `stat` con el gráfico de barras tendrías que especificarlo cuando llamas a la función. Por ejemplo, si tuviésemos ya el conteo de las observaciones tendríamos no necesitaríamos el conteo:

```{r}
library(dplyr)
conteo <- diamonds %>% group_by(cut) %>% count()
```

#### 5. Con el código de arriba y usando `stat='identity'`, ¿puedes hacer el gráfico de barras usando el dataset conteo?

```{r}
ggplot(data = conteo) +
  geom_bar(mapping = aes(x = cut, y = n), stat = "identity")
```

#### 6. Usa `stat_summary` para ver una estadística de la profundidad agrupado por corte. Utiliza la ayuda para poder visualizar la mínima profundidad (`min`), máxima profundidad (`max`) y la media (`median`).

```{r}
ggplot(data = diamonds) +
  stat_summary(mapping = aes(x = cut, y = depth),
               fun.ymin = min,
               fun.ymax = max,
               fun.y = median)
```

Puedes seguir ampliando este tema en [R for DS](http://r4ds.had.co.nz/data-visualisation.html#data-visualisation).